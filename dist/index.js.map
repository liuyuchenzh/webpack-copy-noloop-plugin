{"version":3,"file":"index.js","sources":["../index.js"],"sourcesContent":["const fse = require(\"fs-extra\");\nconst fs = require(\"fs\");\nconst path = require(\"path\");\nconst name = 'webpack-copy-noloop-plugin';\n\nconst isDir = location => fs.statSync(location).isDirectory();\nconst gatherFiles = location => pattern => {\n  return fs.readdirSync(location).reduce((last, file) => {\n    const fileInAbs = path.join(location, \"/\", file);\n    if (isDir(fileInAbs)) {\n      last.concat(gatherFiles(path.join(location, \"/\", file))(pattern));\n    } else {\n      if (pattern.test(fileInAbs)) {\n        last.push(fileInAbs);\n      }\n    }\n    return last;\n  }, []);\n};\n\n/**\n * if copy file from directory\n * generate proper dest path\n * @param {string} dirFromPath\n * @param {string} dirToPath\n * @returns {function(string, boolean=)}\n */\nconst getDestPath = (dirFromPath, dirToPath) => (\n  fileFromPath,\n  flatten = false\n) => {\n  const relativePath = flatten\n    ? path.basename(fileFromPath)\n    : path.relative(dirFromPath, fileFromPath);\n  return path.join(dirToPath, \"/\", relativePath);\n};\n\n/**\n * @typedef {object} CopyItem\n * @property {string} from\n * @property {string} to\n * @property {function(string, string)=} filter\n * @property {regexp=} pattern\n * @property {boolean=} flatten\n */\n\nclass CopyNoLoopPlugin {\n  /**\n   * @param {object} options\n   * @param {CopyItem[]} options.list\n   * @param {string=} options.root root directory\n   */\n  constructor(options) {\n    this.options = options;\n  }\n\n  apply(compiler) {\n    compiler.hooks.done.tap(\"CopyNoLoopPlugin\", () => {\n      const { list, root } = this.options;\n      if (!Array.isArray(list)) return;\n      let listMut = list.slice();\n      if (root) {\n        // check for absolute\n        if (!path.isAbsolute(root)) {\n          throw new Error(`[${name}]: root needs to be an absolute path!`);\n        }\n        listMut = listMut.map(item => {\n          return {\n            ...item,\n            from: path.resolve(root, item.from),\n            to: path.resolve(root, item.to)\n          };\n        });\n      }\n      listMut.forEach(item => {\n        const {\n          from,\n          to,\n          filter = () => true,\n          pattern,\n          flatten = false\n        } = item;\n        if (isDir(from) && pattern) {\n          const files = gatherFiles(from)(pattern);\n          files.forEach(file => {\n            const dest = getDestPath(from, to)(file, flatten);\n            fse.copySync(file, dest, { filter });\n          });\n        } else {\n          fse.copySync(from, to, {\n            filter\n          });\n        }\n      });\n    });\n  }\n}\n\nmodule.exports = CopyNoLoopPlugin;\n"],"names":["const","this"],"mappings":"AAAAA,IAAM,MAAM,OAAA,CAAQ;AACpBA,IAAM,KAAK,OAAA,CAAQ;AACnBA,IAAM,OAAO,OAAA,CAAQ;AACrBA,IAAM,OAAO;AAEbA,IAAM,kBAAQ,mBAAY,EAAA,CAAG,QAAH,CAAY,SAAZ,CAAsB,WAAtB;AAC1BA,IAAM,wBAAc,6BAAY,kBACvB,EAAA,CAAG,WAAH,CAAe,SAAf,CAAyB,MAAzB,WAAiC,IAAM,EAAA,MAAP;IACrCA,IAAM,YAAY,IAAA,CAAK,IAAL,CAAU,UAAU,KAAK;IAC3C,IAAI,KAAA,CAAM,YAAY;QACpB,IAAA,CAAK,MAAL,CAAY,WAAA,CAAY,IAAA,CAAK,IAAL,CAAU,UAAU,KAAK,MAArC,CAA4C;WACnD;QACL,IAAI,OAAA,CAAQ,IAAR,CAAa,YAAY;YAC3B,IAAA,CAAK,IAAL,CAAU;;;IAGd,OAAO;GACN;AAULA,IAAM,wBAAe,WAAa,EAAA,WAAd,mBAClB,YACA,EAAA,SAF8C;qCAE9C,GAAU;;IAEVA,IAAM,eAAe,OAAA,GACjB,IAAA,CAAK,QAAL,CAAc,gBACd,IAAA,CAAK,QAAL,CAAc,aAAa;IAC/B,OAAO,IAAA,CAAK,IAAL,CAAU,WAAW,KAAK;;AAYnC,IAAM,mBAMJ,0BAAY,SAAS;IACnB,IAAA,CAAK,OAAL,GAAe;;2BAGjB,wBAAM,UAAU;;;YACd,CAAS,KAAT,CAAe,IAAf,CAAoB,GAApB,CAAwB,gCAAoB;kBACnBC,MAAA,CAAK;YAApB;YAAM;QACd,IAAI,CAAC,KAAA,CAAM,OAAN,CAAc;cAAO;YACtB,UAAU,IAAA,CAAK,KAAL;YACV,MAAM;gBAEJ,CAAC,IAAA,CAAK,UAAL,CAAgB,OAAO;sBACpB,IAAI,KAAJ,QAAc;;mBAEtB,GAAU,OAAA,CAAQ,GAAR,WAAY,gBACb,kBACF,IADE;iBAEL,MAAM,IAAA,CAAK,OAAL,CAAa,MAAM,IAAA,CAAK,KAFzB;gBAGL,IAAI,IAAA,CAAK,OAAL,CAAa,MAAM,IAAA,CAAK;;QAIlC,OAAA,CAAQ,OAAR,WAAgB;;gBAGZ;wFACS,SAAM;gBACf;gFACU;YAEZ,IAAI,KAAA,CAAM,KAAN,IAAe,SAAS;oBACpB,QAAQ,WAAA,CAAY,KAAZ,CAAkB;gBAChC,KAAA,CAAM,OAAN,WAAc;oBACZD,IAAM,OAAO,WAAA,CAAY,MAAM,GAAlB,CAAsB,MAAM;oBACzC,GAAA,CAAI,QAAJ,CAAa,MAAM,MAAM;gCAAE;;;mBAExB;gBACL,GAAA,CAAI,QAAJ,CAAa,MAAM,IAAI;4BACrB;;;;;;AAQZ,MAAA,CAAO,OAAP,GAAiB"}