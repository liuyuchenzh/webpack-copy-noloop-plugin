{"version":3,"file":"index.mjs","sources":["../index.js"],"sourcesContent":["const fse = require(\"fs-extra\");\nconst fs = require(\"fs\");\nconst path = require(\"path\");\nconst name = \"webpack-copy-noloop-plugin\";\n\nconst isDir = location => fs.statSync(location).isDirectory();\nconst gatherFiles = location => pattern => {\n  return fs.readdirSync(location).reduce((last, file) => {\n    const fileInAbs = path.join(location, \"/\", file);\n    if (isDir(fileInAbs)) {\n      last.concat(gatherFiles(path.join(location, \"/\", file))(pattern));\n    } else {\n      if (pattern.test(fileInAbs)) {\n        last.push(fileInAbs);\n      }\n    }\n    return last;\n  }, []);\n};\n\n/**\n * if copy file from directory\n * generate proper dest path\n * @param {string} dirFromPath\n * @param {string} dirToPath\n * @returns {function(string, boolean=)}\n */\nconst getDestPath = (dirFromPath, dirToPath) => (\n  fileFromPath,\n  flatten = false\n) => {\n  const relativePath = flatten\n    ? path.basename(fileFromPath)\n    : path.relative(dirFromPath, fileFromPath);\n  return path.join(dirToPath, \"/\", relativePath);\n};\n\n/**\n * @typedef {object} CopyItem\n * @property {string} from\n * @property {string} to\n * @property {function(string, string)=} filter\n * @property {regexp=} pattern\n * @property {boolean=} flatten\n */\n\nclass CopyNoLoopPlugin {\n  /**\n   * @param {object} options\n   * @param {CopyItem[]} options.list\n   * @param {string=} options.root root directory\n   * @param {boolean=} [options.move=false] whether to move or not\n   */\n  constructor(options) {\n    this.options = options;\n  }\n\n  apply(compiler) {\n    compiler.hooks.done.tap(\"CopyNoLoopPlugin\", () => {\n      const { list, root, move = false } = this.options;\n      const action = move ? \"moveSync\" : \"copySync\";\n      if (!Array.isArray(list)) return;\n      let listMut = list.slice();\n      if (root) {\n        // check for absolute\n        if (!path.isAbsolute(root)) {\n          throw new Error(`[${name}]: root needs to be an absolute path!`);\n        }\n        listMut = listMut.map(item => {\n          return {\n            ...item,\n            from: path.resolve(root, item.from),\n            to: path.resolve(root, item.to)\n          };\n        });\n      }\n      listMut.forEach(item => {\n        const {\n          from,\n          to,\n          filter = () => true,\n          pattern,\n          flatten = false\n        } = item;\n        if (isDir(from) && pattern) {\n          const files = gatherFiles(from)(pattern);\n          files.forEach(file => {\n            const dest = getDestPath(from, to)(file, flatten);\n            fse[action](file, dest, { filter, overwrite: true });\n          });\n        } else {\n          fse[action](from, to, {\n            filter,\n            overwrite: true\n          });\n        }\n      });\n    });\n  }\n}\n\nmodule.exports = CopyNoLoopPlugin;\n"],"names":["const","fse","require","fs","path","name","isDir","location","statSync","isDirectory","gatherFiles","pattern","readdirSync","reduce","last","file","fileInAbs","join","concat","test","push","getDestPath","dirFromPath","dirToPath","fileFromPath","flatten","relativePath","basename","relative","CopyNoLoopPlugin","constructor","options","apply","compiler","hooks","done","tap","this","list","root","action","move","Array","isArray","listMut","slice","isAbsolute","Error","map","item","from","resolve","to","forEach","files","dest","filter","module","exports"],"mappings":"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"}