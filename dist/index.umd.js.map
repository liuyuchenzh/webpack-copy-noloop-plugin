{"version":3,"file":"index.umd.js","sources":["../index.js"],"sourcesContent":["const fse = require(\"fs-extra\");\nconst fs = require(\"fs\");\nconst path = require(\"path\");\nconst name = 'webpack-copy-noloop-plugin';\n\nconst isDir = location => fs.statSync(location).isDirectory();\nconst gatherFiles = location => pattern => {\n  return fs.readdirSync(location).reduce((last, file) => {\n    const fileInAbs = path.join(location, \"/\", file);\n    if (isDir(fileInAbs)) {\n      last.concat(gatherFiles(path.join(location, \"/\", file))(pattern));\n    } else {\n      if (pattern.test(fileInAbs)) {\n        last.push(fileInAbs);\n      }\n    }\n    return last;\n  }, []);\n};\n\n/**\n * if copy file from directory\n * generate proper dest path\n * @param {string} dirFromPath\n * @param {string} dirToPath\n * @returns {function(string, boolean=)}\n */\nconst getDestPath = (dirFromPath, dirToPath) => (\n  fileFromPath,\n  flatten = false\n) => {\n  const relativePath = flatten\n    ? path.basename(fileFromPath)\n    : path.relative(dirFromPath, fileFromPath);\n  return path.join(dirToPath, \"/\", relativePath);\n};\n\n/**\n * @typedef {object} CopyItem\n * @property {string} from\n * @property {string} to\n * @property {function(string, string)=} filter\n * @property {regexp=} pattern\n * @property {boolean=} flatten\n */\n\nclass CopyNoLoopPlugin {\n  /**\n   * @param {object} options\n   * @param {CopyItem[]} options.list\n   * @param {string=} options.root root directory\n   */\n  constructor(options) {\n    this.options = options;\n  }\n\n  apply(compiler) {\n    compiler.hooks.done.tap(\"CopyNoLoopPlugin\", () => {\n      const { list, root } = this.options;\n      if (!Array.isArray(list)) return;\n      let listMut = list.slice();\n      if (root) {\n        // check for absolute\n        if (!path.isAbsolute(root)) {\n          throw new Error(`[${name}]: root needs to be an absolute path!`);\n        }\n        listMut = listMut.map(item => {\n          return {\n            ...item,\n            from: path.resolve(root, item.from),\n            to: path.resolve(root, item.to)\n          };\n        });\n      }\n      listMut.forEach(item => {\n        const {\n          from,\n          to,\n          filter = () => true,\n          pattern,\n          flatten = false\n        } = item;\n        if (isDir(from) && pattern) {\n          const files = gatherFiles(from)(pattern);\n          files.forEach(file => {\n            const dest = getDestPath(from, to)(file, flatten);\n            fse.copySync(file, dest, { filter });\n          });\n        } else {\n          fse.copySync(from, to, {\n            filter\n          });\n        }\n      });\n    });\n  }\n}\n\nmodule.exports = CopyNoLoopPlugin;\n"],"names":["const","this"],"mappings":";;;;;EAAAA,IAAM,MAAM,OAAA,CAAQ;EACpBA,IAAM,KAAK,OAAA,CAAQ;EACnBA,IAAM,OAAO,OAAA,CAAQ;EACrBA,IAAM,OAAO;EAEbA,IAAM,kBAAQ,mBAAY,EAAA,CAAG,QAAH,CAAY,SAAZ,CAAsB,WAAtB;EAC1BA,IAAM,wBAAc,6BAAY,kBACvB,EAAA,CAAG,WAAH,CAAe,SAAf,CAAyB,MAAzB,WAAiC,IAAM,EAAA,MAAP;MACrCA,IAAM,YAAY,IAAA,CAAK,IAAL,CAAU,UAAU,KAAK;MAC3C,IAAI,KAAA,CAAM,YAAY;UACpB,IAAA,CAAK,MAAL,CAAY,WAAA,CAAY,IAAA,CAAK,IAAL,CAAU,UAAU,KAAK,MAArC,CAA4C;aACnD;UACL,IAAI,OAAA,CAAQ,IAAR,CAAa,YAAY;cAC3B,IAAA,CAAK,IAAL,CAAU;;;MAGd,OAAO;KACN;EAULA,IAAM,wBAAe,WAAa,EAAA,WAAd,mBAClB,YACA,EAAA,SAF8C;uCAE9C,GAAU;;MAEVA,IAAM,eAAe,OAAA,GACjB,IAAA,CAAK,QAAL,CAAc,gBACd,IAAA,CAAK,QAAL,CAAc,aAAa;MAC/B,OAAO,IAAA,CAAK,IAAL,CAAU,WAAW,KAAK;;EAYnC,IAAM,mBAMJ,0BAAY,SAAS;MACnB,IAAA,CAAK,OAAL,GAAe;EACnB;6BAEE,wBAAM,UAAU;;;cACd,CAAS,KAAT,CAAe,IAAf,CAAoB,GAApB,CAAwB,gCAAoB;oBACnBC,MAAA,CAAK;cAApB;cAAM;UACd,IAAI,CAAC,KAAA,CAAM,OAAN,CAAc;gBAAO;cACtB,UAAU,IAAA,CAAK,KAAL;cACV,MAAM;kBAEJ,CAAC,IAAA,CAAK,UAAL,CAAgB,OAAO;wBACpB,IAAI,KAAJ,QAAc;;qBAEtB,GAAU,OAAA,CAAQ,GAAR,WAAY,gBACb,kBACF,IADE;mBAEL,MAAM,IAAA,CAAK,OAAL,CAAa,MAAM,IAAA,CAAK,KAFzB;kBAGL,IAAI,IAAA,CAAK,OAAL,CAAa,MAAM,IAAA,CAAK;;UAIlC,OAAA,CAAQ,OAAR,WAAgB;;kBAGZ;0FACS,SAAM;kBACf;kFACU;cAEZ,IAAI,KAAA,CAAM,KAAN,IAAe,SAAS;sBACpB,QAAQ,WAAA,CAAY,KAAZ,CAAkB;kBAChC,KAAA,CAAM,OAAN,WAAc;sBACZD,IAAM,OAAO,WAAA,CAAY,MAAM,GAAlB,CAAsB,MAAM;sBACzC,GAAA,CAAI,QAAJ,CAAa,MAAM,MAAM;kCAAE;;;qBAExB;kBACL,GAAA,CAAI,QAAJ,CAAa,MAAM,IAAI;8BACrB;;;;;EAKZ;EAGA,MAAA,CAAO,OAAP,GAAiB;;;;;;;"}